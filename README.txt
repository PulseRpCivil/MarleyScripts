v0.4.0

Фикс твоей ошибки:
- oxmysql/driver возвращает TINYINT(1) как boolean (true/false).
Из-за этого:
  1) tonumber(true) -> nil => добыча всегда считалась OFF
  2) строка логов пыталась склеить '.. prod.is_running' где prod.is_running=true => краш

Исправлено:
- Добавлен asInt01() и он используется ВЕЗДЕ где читается is_running.
- Все debug concat сделаны через tostring().

После этого:
- is_running=true будет трактоваться как 1
- добыча реально запустится, кнопка переключится, прогресс появится, тики начнут добавлять предметы в stash.

v0.4.1
- Фикс: авто-обновление меню больше не открывает меню заново после закрытия (ESC).
- Используется onExit у ox_lib context + флаг menuOpen + остановка refresh-thread.


v0.4.2
- Добавлены блипы на карту: вышки в продаже и купленные (разные цвета/настройки через Config.Blips).
- Блипы берутся из таблицы oilrig_rigs (регистрация /oilrig_scan).
- Обновление блипов по событиям покупки/продажи + команда /oilrig_blips для ручного обновления.


v0.4.3
- Блипы теперь дальние по умолчанию (ShortRange=false), видны всем по всей карте.
- Спрайт блипа установлен на 441 (и для продажи, и для купленных).


v0.4.4
- Фикс: при открытии инвентаря вышки меню закрывается и авто-обновление останавливается. Меню не открывается снова само.

v0.5.0
- Добавлена точка продажи/переработки нефти: vector3(1713.28, -1555.23, 113.93).
- ox_lib меню + lib.inputDialog (slider) с max по наличию нефти/крафта.
- Продажа: списывает Config.OilItem и начисляет деньги на банк.
- Переработка: списывает нефть и выдаёт rubber/plastic (настраивается в Config.Refinery.Recipes).
- Важно: items 'rubber' и 'plastic' должны существовать в ox_inventory items.


v0.5.1
- Фикс: setupRefineryTarget() вызывается при старте ресурса (и защищён от дублей).


v0.5.2
- Фикс: создание target-зоны переработки стало надёжным (ожидает ox_target, делает несколько попыток).
- Опция UseGroundZ=true (привязка Z к земле, если Z из конфига неточный).
- Команда /oilrig_refinery для теста меню без target.

v0.5.4
- Фикс: переработка теперь НЕ выдаёт результат сразу.
- Запуск переработки создаёт job в oilrig_refinery_jobs (нефть списывается сразу).
- Прогресс отображается в меню ox_lib, обновляется локально раз в 1 сек.
- Получение результата через кнопку 'Забрать результат' после завершения.


v0.5.5
- Фикс: на клиенте нет global os.*, поэтому прогресс переработки считаетcя через GetGameTimer() (локально) без ошибок.


v0.5.6
- Фикс: resetLocalJobBaseline/updateLocalJobProgress были объявлены после использования и как local, из-за чего вызывались как nil. Переведено в глобальные функции для корректного вызова.


v0.5.7
- Фикс: formatSeconds был local/недоступен в момент вызова. Сделан глобальным.

v0.6.0
- Рефакторинг БД: oilrig_rigs получает rig_id (AUTO_INCREMENT), deposit_total, deposit_remaining.
- Сервер при старте сидит Config.Rigs в oilrig_rigs (все вышки сразу в БД с постоянным rig_key).
- Добыча учитывает иссякаемое месторождение: deposit_remaining уменьшается; при 0 добыча останавливается.
- В меню вышки добавлен read-only прогресс 'Месторождение' (если данные есть).


v0.6.1
- Меню вышки: добавлен пункт 'Месторождение' с прогресс-баром и значениями остатка.
- Покупка: уведомление и описание покупки показывают количество нефти в месторождении.


v0.6.2
- Фикс: синтаксис client.lua (описание покупки) — перенос строки в depLine теперь корректный (\\n).


v0.6.3
- Фикс: deposit_remaining больше НЕ сбрасывается при seed/перезапуске (добавлен deposit_initialized).
- Инициализация месторождения выполняется один раз; 0 теперь корректно означает 'иссякло'.
- В меню до покупки строка 'Месторождение: X / Y' заполняется из БД (и будет показываться всегда).

v0.6.4
- Фикс критической ошибки getRigState: добавлена миграция deposit_initialized.
- Seed/миграция больше не сбрасывают deposit_remaining при 0 (не 'рефиллит' выкачанные месторождения).
- Новые вышки получают deposit_* при первом INSERT IGNORE.
- Перед покупкой в меню показывается строка 'Месторождение: X / Y'.


v0.7.0
- Ограничение: игрок может владеть только 1 нефтевышкой.
- Месторождение: при 0 начинается кулдаун 7 дней (Config.DepositCooldownSeconds). До конца кулдауна вышку нельзя купить и нельзя запустить добычу.
- Лицензия: добавлена покупка лицензии (ox_target + ox_lib) с выдачей item с метаданными (имя/фамилия, дата, номер) и записью в БД oilrig_licenses.
- Покупка вышки требует наличия лицензии (Config.License.Enabled).


v0.7.1
- Фикс: client.lua синтаксис — локальные переменные вынесены из table literal в пункте покупки вышки.


v0.7.2
- Фикс: client.lua — строка предупреждения о кулдауне была разорвана переносом строки в кавычках. Теперь используется \\n.


v0.7.3
- Фикс: client.lua — окончательно убран реальный перенос строки внутри desc (покупка). Используется \\n.


v0.7.4
- Фикс: client.lua — полностью переписан блок покупки (if not state.ownerCid) чтобы убрать сломанные переносы и невалидные строки.


v0.7.5
- Фикс: client.lua — блок покупки был повреждён (переносы внутри строк). Полностью перезаписан корректным Lua.


v0.7.6
- Клиент: блок покупки приведён к корректному Lua (без разорванных строк). Переносы в описании через \n.


v0.7.7
- Фикс: client.lua — блок покупки переписан заново, строковые переносы только через \n (без реальных переводов строки внутри кавычек).


v0.7.8
- Фикс: client.lua — убраны случайные литералы \\n, попавшие в код вне строк (ломали парсинг, line 31-36).

v0.7.9
- Добавлена админ-команда /giveoillicense [playerId] (ACE: qbx_oilrig.give_license) для выдачи лицензии.
  Чтобы выдать права:

v0.7.10

v0.7.11
- /giveoillicense теперь restricted=true (ACE command permission). Админы (group.admin) смогут использовать без отдельного ACE под ресурс.

v0.8.2
- Фикс: /giveoillicense и покупка лицензии — getPlayer/getCID/notify теперь корректно доступны (forward declarations + assignment), больше нет nil ошибок.

v0.8.3
- Item лицензии сменён на oillicense (метаданные выдаются и видны в ox_inventory tooltip).
- Item нефти сменён на oil.
- Склад вышки увеличен до 2000кг (Config.StashMaxWeight = 2000000).
- Добавлена команда /removeoillicense [playerId] (restricted=true) для удаления лицензии у игрока (инвентарь + БД).

ox_inventory items (добавь на сервере):
- oil (нефть)
- oillicense (лицензия)

Чтобы метаданные были ВИДНЫ в tooltip (Modern UI Kit), добавь в items.lua для oillicense:
['oillicense'] = {
    label = 'Лицензия на добычу нефти',
    weight = 10,
    stack = false,
    close = true,
    description = 'Официальная лицензия на добычу нефти',
    metadata = {
        license_no = 'Номер',
        full_name = 'Владелец',
        issued_date = 'Выдана',
        expires_date = 'Действует до'
    }
}

v0.8.4
- Лицензия: метаданные (ФИО/даты) + срок действия (Config.License.ValidDays).
- Месторождение: дефолт 15000.
- Добыча: если склад переполнен — добыча автоматически останавливается.
- Блипы: отображаются на карте, но не на миникарте (SetBlipDisplay=3).

v0.8.5
- Tooltip: добавлен вызов exports.ox_inventory:displayMetadata(...) чтобы ox_inventory показывал метаданные лицензии в подсказке.
- Если у игрока уже есть старая лицензия без метаданных: /removeoillicense -> /giveoillicense.

v0.8.6
- Меню вышки: нейтральные цвета для пунктов (buy/sell/inventory/equipment/deposit).
- Пункт(ы) запуска/остановки добычи перенесены вверх сразу под «Месторождение».

v0.8.7
- Оборудование: исправлены цвета прогрессбаров. Убраны неподдерживаемые схемы (lime/orange), добавлен градиентный hex-цвет для иконки и (если поддерживается UI) progressColor.

v0.8.8
- Добавлены работники: владелец может добавить игрока по Server ID и настроить права (склад/добыча/ремонт).
- Доступ работника: склад (openStash), управление добычей (setProduction), ремонт (repairPart).
- Продажа/покупка остаются только у владельца.

v0.8.9
- Исправлено: владелец снова имеет доступ к ремонту (клиент учитывает isOwner).
- getEquipment теперь возвращает canRepair (владелец или работник с правом repair).

